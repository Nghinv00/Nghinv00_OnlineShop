(function($){var PLUGIN_NAMESPACE="LazyScrollLoading";var PLUGIN_LAZYIMAGE_ATTR="data-lazyimg";var defaultOptions={isDefaultLazyImageMode:false,lazyItemSelector:null,delay:500,resetScrollBarPositionAfterEventTriggered:true,onCreate:null,onScroll:null,onLazyItemFirstVisible:null,onLazyItemVisible:null,onLazyItemInvisible:null,onScrollVertically:null,onScrollHorizontally:null,onScrollUp:null,onScrollDown:null,onScrollLeft:null,onScrollRight:null,onScrollToTop:null,onScrollToBottom:null,onScrollToLeftmost:null,onScrollToRightmost:null};var userAgentStr=navigator.userAgent.toLowerCase();var isIE=/msie/.test(userAgentStr);var IEVersion=isIE?parseFloat((userAgentStr.match(/.*(?:rv|ie)[\/: ](.+?)([ \);]|$)/)||[])[1]):-1;var scrollBarSize=16;$.extend($.fn,{lazyScrollLoading:function(options){options=$.extend({},defaultOptions,options);if(options.isDefaultLazyImageMode&&options.lazyItemSelector==null){options.lazyItemSelector="img["+PLUGIN_LAZYIMAGE_ATTR+"]:not([src])"}return this.each(function(){var $container=$(this);$container.destroyLazyScrollLoading();$container.data("options."+PLUGIN_NAMESPACE,options);initializeLazyScrollLoading($container,options);if(options.onCreate!=null){options.onCreate.apply($container[0])}})},getLazyScrollLoadingOptions:function(){return this.data("options."+PLUGIN_NAMESPACE)},getLazyScrollLoadingScrollHistory:function(){return this.data("scrollHistory."+PLUGIN_NAMESPACE)},clearLazyScrollLoadingScrollHistory:function(){return this.removeData("scrollHistory."+PLUGIN_NAMESPACE)},getLazyScrollLoadingViewport:function(){var $container=this;var containerViewport=$container.data("viewport."+PLUGIN_NAMESPACE);if(containerViewport==null){var container=$container[0];var isRoot=isRootContainer(container);var $window=$(window);var $document=$(document);var $body=$(document.body);containerViewport={getOffset:function(){return isRoot?$body.offset():$container.offset()},getScrollLeft:function(){return(isRoot?$window:$container).scrollLeft()},getScrollTop:function(){return(isRoot?$window:$container).scrollTop()},getScrollBindTarget:function(){return isRoot?$window:$container},getWidth:function(isOuter){return isRoot?$window.width():isOuter?$container.outerWidth():$container.innerWidth()},getHeight:function(isOuter){return isRoot?$window.height():isOuter?$container.outerHeight():$container.innerHeight()},getScrollWidth:function(includeScrollBarSize){return(isRoot?$document.width():container.scrollWidth)+(includeScrollBarSize&&this.isVerticalScrollBarVisible()?scrollBarSize:0)},getScrollHeight:function(includeScrollBarSize){return(isRoot?$document.height():container.scrollHeight)+(includeScrollBarSize&&this.isHorizontalScrollBarVisible()?scrollBarSize:0)},getLeftPos:function(){return isRoot?this.getScrollLeft():this.getOffset().left},getTopPos:function(){return isRoot?this.getScrollTop():this.getOffset().top},getRightPos:function(){return this.getLeftPos()+this.getWidth(true)},getBottomPos:function(){return this.getTopPos()+this.getHeight(true)},isVerticalScrollBarVisible:function(){return this.getHeight(false)<this.getScrollHeight(false)},isHorizontalScrollBarVisible:function(){return this.getWidth(false)<this.getScrollWidth(false)},isVerticalScrollBarScrolling:function(){if(!this.isVerticalScrollBarVisible()){return false}var containerScrollHistory=$container.getLazyScrollLoadingScrollHistory();return containerScrollHistory!=null&&containerScrollHistory.scrollTop!=this.getScrollTop()},isHorizontalScrollBarScrolling:function(){if(!this.isHorizontalScrollBarVisible()){return false}var containerScrollHistory=$container.getLazyScrollLoadingScrollHistory();return containerScrollHistory!=null&&containerScrollHistory.scrollLeft!=this.getScrollLeft()},isScrollUp:function(){if(!this.isVerticalScrollBarVisible()){return false}var containerScrollHistory=$container.getLazyScrollLoadingScrollHistory();return containerScrollHistory!=null&&containerScrollHistory.scrollTop>this.getScrollTop()},isScrollDown:function(){if(!this.isVerticalScrollBarVisible()){return false}var containerScrollHistory=$container.getLazyScrollLoadingScrollHistory();return containerScrollHistory!=null&&containerScrollHistory.scrollTop<this.getScrollTop()},isScrollLeft:function(){if(!this.isHorizontalScrollBarVisible()){return false}var containerScrollHistory=$container.getLazyScrollLoadingScrollHistory();return containerScrollHistory!=null&&containerScrollHistory.scrollLeft>this.getScrollLeft()},isScrollRight:function(){if(!this.isHorizontalScrollBarVisible()){return false}var containerScrollHistory=$container.getLazyScrollLoadingScrollHistory();return containerScrollHistory!=null&&containerScrollHistory.scrollLeft<this.getScrollLeft()},isScrollToTop:function(){if(!this.isVerticalScrollBarVisible()){return false}return this.getScrollTop()<=0},isScrollToBottom:function(){if(!this.isVerticalScrollBarVisible()){return false}return this.getScrollTop()+this.getHeight(true)>=this.getScrollHeight(true)},isScrollToLeftmost:function(){if(!this.isHorizontalScrollBarVisible()){return false}return this.getScrollLeft()<=0},isScrollToRightmost:function(){if(!this.isHorizontalScrollBarVisible()){return false}return this.getScrollLeft()+this.getWidth(true)>=this.getScrollWidth(true)}}}$container.data("viewport."+PLUGIN_NAMESPACE,containerViewport);return containerViewport},getLazyScrollLoadingCachedLazyItems:function(selector){return this.pushStack($.map(this,function(container){var $container=$(container);var options=$container.getLazyScrollLoadingOptions();var $lazyItems=$container.data("items."+PLUGIN_NAMESPACE);if(options!=null&&options.lazyItemSelector!=null&&$lazyItems==null){$lazyItems=$(options.lazyItemSelector,isRootContainer(container)?undefined:$container);$container.data("items."+PLUGIN_NAMESPACE,$lazyItems)}if($lazyItems!=null&&selector!=null){$lazyItems=$lazyItems.filter(selector)}return $lazyItems!=null?$lazyItems.get():null}))},clearLazyScrollLoadingCachedLazyItems:function(){return this.removeData("items."+PLUGIN_NAMESPACE)},refreshLazyScrollLoading:function(){return this.clearLazyScrollLoadingCachedLazyItems()},destroyLazyScrollLoading:function(){return this.each(function(){var $container=$(this);$container.getLazyScrollLoadingViewport().getScrollBindTarget().unbind("scroll."+PLUGIN_NAMESPACE);$container.getLazyScrollLoadingCachedLazyItems().removeData("isLoaded."+PLUGIN_NAMESPACE);$container.clearLazyScrollLoadingCachedLazyItems().clearLazyScrollLoadingScrollHistory().removeData("viewport."+PLUGIN_NAMESPACE).removeData("options."+PLUGIN_NAMESPACE)})},isLazyScrollLoadingLazyItemLoaded:function(){return this.data("isLoaded."+PLUGIN_NAMESPACE)},isLazyScrollLoadingLazyItemLoading:function(){return this.data("isLoading."+PLUGIN_NAMESPACE)},isLazyScrollLoadingLazyItemVisible:function($container){var lazyItemViewport=this.getLazyScrollLoadingViewport();var containerViewport=$container.getLazyScrollLoadingViewport();return lazyItemViewport.getBottomPos()>containerViewport.getTopPos()&&lazyItemViewport.getLeftPos()<containerViewport.getRightPos()&&lazyItemViewport.getTopPos()<containerViewport.getBottomPos()&&lazyItemViewport.getRightPos()>containerViewport.getLeftPos()}});function isRootContainer(container){return container==window||container==document||container==document.body}function initializeLazyScrollLoading($container,options){var containerViewport=$container.getLazyScrollLoadingViewport();var $scrollBindTarget=containerViewport.getScrollBindTarget();var isTimerOn=false;var timer=null;$scrollBindTarget.bind("scroll."+PLUGIN_NAMESPACE,function(e){if(options.delay<=0){fireOnScrollEvent(e,$container,options)}else if(!isTimerOn){isTimerOn=true;if(timer!=null){clearTimeout(timer)}timer=setTimeout(function(){fireOnScrollEvent(e,$container,options);clearTimeout(timer);isTimerOn=false},options.delay)}});if(containerViewport.getScrollTop()<=0&&containerViewport.getScrollLeft()<=0||isIE&&IEVersion<9){$scrollBindTarget.trigger("scroll."+PLUGIN_NAMESPACE)}}function fireOnScrollEvent(e,$container,options){var $lazyItems=$container.getLazyScrollLoadingCachedLazyItems();var lazyItemVisibleArray=[];var lazyItemFirstVisibleArray=[];var lazyItemInvisibleArray=[];if(options.lazyItemSelector!=null&&(options.isDefaultLazyImageMode||options.onLazyItemFirstVisible!=null||options.onLazyItemVisible!=null||options.onLazyItemInvisible!=null)){$lazyItems.each(function(){var $lazyItem=$(this);if($lazyItem.isLazyScrollLoadingLazyItemVisible($container)){$lazyItem.data("isLoading."+PLUGIN_NAMESPACE,true);lazyItemVisibleArray.push(this);if(!$lazyItem.isLazyScrollLoadingLazyItemLoaded()){$lazyItem.data("isLoaded."+PLUGIN_NAMESPACE,true);lazyItemFirstVisibleArray.push(this)}}else if($lazyItem.isLazyScrollLoadingLazyItemLoading()){$lazyItem.removeData("isLoading."+PLUGIN_NAMESPACE);lazyItemInvisibleArray.push(this)}});if(options.isDefaultLazyImageMode){for(var i=0,lazyItemFirstVisibleArraySize=lazyItemFirstVisibleArray.length;i<lazyItemFirstVisibleArraySize;i++){var lazyImageItem=lazyItemFirstVisibleArray[i];lazyImageItem.src=lazyImageItem.getAttribute(PLUGIN_LAZYIMAGE_ATTR)}}}var containerViewport=$container.getLazyScrollLoadingViewport();var scrollTop=containerViewport.getScrollTop();var scrollLeft=containerViewport.getScrollLeft();var newScrollHistory={scrollTop:scrollTop,scrollLeft:scrollLeft};triggerCallbackFunctions(e,$container,options,$lazyItems,lazyItemVisibleArray,lazyItemFirstVisibleArray,lazyItemInvisibleArray);if(options.resetScrollBarPositionAfterEventTriggered){$container.scrollTop(scrollTop);$container.scrollLeft(scrollLeft)}$container.data("scrollHistory."+PLUGIN_NAMESPACE,newScrollHistory)}function triggerCallbackFunctions(e,$container,options,$lazyItems,lazyItemVisibleArray,lazyItemFirstVisibleArray,lazyItemInvisibleArray){var container=$container[0];if(options.onScroll!=null){options.onScroll.apply(container,[e])}if(options.onScrollVertically!=null||options.onScrollUp!=null||options.onScrollDown!=null||options.onScrollToTop!=null||options.onScrollToBottom!=null||options.onScrollHorizontally!=null||options.onScrollLeft!=null||options.onScrollRight!=null||options.onScrollToLeftmost!=null||options.onScrollToRightmost!=null){var containerViewport=$container.getLazyScrollLoadingViewport();var defaultApplyParameter=[e,$lazyItems];if(containerViewport.isVerticalScrollBarScrolling()){if(options.onScrollVertically!=null){options.onScrollVertically.apply(container,defaultApplyParameter)}if(options.onScrollUp!=null&&containerViewport.isScrollUp()){options.onScrollUp.apply(container,defaultApplyParameter)}if(options.onScrollDown!=null&&containerViewport.isScrollDown()){options.onScrollDown.apply(container,defaultApplyParameter)}if(options.onScrollToTop!=null&&containerViewport.isScrollToTop()){options.onScrollToTop.apply(container,defaultApplyParameter)}if(options.onScrollToBottom!=null&&containerViewport.isScrollToBottom()){options.onScrollToBottom.apply(container,defaultApplyParameter)}}if(containerViewport.isHorizontalScrollBarScrolling()){if(options.onScrollHorizontally!=null){options.onScrollHorizontally.apply(container,defaultApplyParameter)}if(options.onScrollLeft!=null&&containerViewport.isScrollLeft()){options.onScrollLeft.apply(container,defaultApplyParameter)}if(options.onScrollRight!=null&&containerViewport.isScrollRight()){options.onScrollRight.apply(container,defaultApplyParameter)}if(options.onScrollToLeftmost!=null&&containerViewport.isScrollToLeftmost()){options.onScrollToLeftmost.apply(container,defaultApplyParameter)}if(options.onScrollToRightmost!=null&&containerViewport.isScrollToRightmost()){options.onScrollToRightmost.apply(container,defaultApplyParameter)}}}if(options.onLazyItemFirstVisible!=null&&lazyItemFirstVisibleArray.length>0){options.onLazyItemFirstVisible.apply(container,[e,$lazyItems,$container.pushStack(lazyItemFirstVisibleArray)])}if(options.onLazyItemVisible!=null&&lazyItemVisibleArray.length>0){options.onLazyItemVisible.apply(container,[e,$lazyItems,$container.pushStack(lazyItemVisibleArray)])}if(options.onLazyItemInvisible!=null&&lazyItemInvisibleArray.length>0){options.onLazyItemInvisible.apply(container,[e,$lazyItems,$container.pushStack(lazyItemInvisibleArray)])}}})(jQuery);